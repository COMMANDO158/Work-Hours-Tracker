<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weekly Reflection - FlowFocus</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        :root {
            --primary: #dc143c;
            --primary-light: #ff2e4d;
            --primary-dark: #9d0b28;
            --primary-glow: rgba(220, 20, 60, 0.5);
            --secondary: #ff6b9d;
            --success: #ff94a8;
            --warning: #ff4757;
            --light: #f8f9fa;
            --dark: #0a0a0a;
            --darker: #000000;
            --gray: #a0a0a0;
            --card-bg: #1a1a1a;
            --card-elevated: #242424;
            --border: #333;
            --border-hover: #444;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background: radial-gradient(ellipse at top, #1a0a0f 0%, #0a0a0a 50%, #000000 100%);
            color: var(--light);
            min-height: 100vh;
            padding: 20px;
            position: relative;
        }
        
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 20% 30%, rgba(220, 20, 60, 0.08) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(220, 20, 60, 0.06) 0%, transparent 50%);
            pointer-events: none;
            z-index: 0;
        }
        
        .container {
            max-width: 700px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }
        
        .back-link {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            color: var(--primary);
            text-decoration: none;
            font-weight: 700;
            margin-bottom: 25px;
            padding: 12px 24px;
            background: var(--card-bg);
            border-radius: 30px;
            border: 2px solid var(--border);
            transition: all 0.3s ease;
            font-size: 0.95rem;
        }
        
        .back-link:hover {
            border-color: var(--primary);
            transform: translateX(-5px);
            box-shadow: 0 4px 15px var(--primary-glow);
        }
        
        header {
            text-align: center;
            margin-bottom: 35px;
            padding: 25px;
            background: linear-gradient(135deg, rgba(220, 20, 60, 0.1) 0%, rgba(26, 26, 26, 0.6) 100%);
            border-radius: 20px;
            border: 1px solid var(--border);
            box-shadow: 0 8px 32px rgba(220, 20, 60, 0.15);
        }
        
        h1 {
            font-size: 2.2rem;
            font-weight: 900;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 50%, var(--secondary) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
            letter-spacing: 1px;
        }
        
        .week-range {
            color: var(--gray);
            font-size: 1rem;
            font-weight: 500;
        }
        
        .card {
            background: linear-gradient(135deg, rgba(26, 26, 26, 0.9) 0%, rgba(18, 18, 18, 0.9) 100%);
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
            padding: 30px;
            margin-bottom: 25px;
            border: 1px solid var(--border);
            transition: all 0.3s ease;
        }
        
        .card:hover {
            box-shadow: 0 12px 40px rgba(220, 20, 60, 0.2);
            border-color: var(--border-hover);
        }
        
        .card-title {
            font-size: 1.3rem;
            font-weight: 800;
            margin-bottom: 25px;
            color: var(--light);
            display: flex;
            align-items: center;
            gap: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .card-title i {
            color: var(--primary);
        }
        
        /* At a Glance Stats */
        .glance-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }
        
        .glance-item {
            text-align: center;
            padding: 20px;
            background: var(--card-elevated);
            border-radius: 15px;
            border: 1px solid var(--border);
            transition: all 0.3s ease;
        }
        
        .glance-item:hover {
            border-color: var(--primary);
            transform: translateY(-3px);
        }
        
        .glance-value {
            font-size: 2rem;
            font-weight: 900;
            color: var(--primary);
            margin-bottom: 8px;
            font-variant-numeric: tabular-nums;
        }
        
        .glance-label {
            font-size: 0.85rem;
            color: var(--gray);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .glance-sublabel {
            font-size: 0.8rem;
            color: var(--gray);
            margin-top: 8px;
            opacity: 0.7;
        }
        
        .comparison {
            margin-top: 20px;
            padding: 15px;
            background: rgba(220, 20, 60, 0.08);
            border-radius: 12px;
            text-align: center;
            border: 1px solid rgba(220, 20, 60, 0.2);
        }
        
        .comparison-text {
            color: var(--light);
            font-size: 0.95rem;
            line-height: 1.6;
        }
        
        .comparison-arrow {
            color: var(--primary);
            font-weight: 700;
        }
        
        /* Chart */
        .chart-container {
            position: relative;
            height: 300px;
            margin: 20px 0;
        }
        
        /* One Insight Box */
        .insight-box {
            background: linear-gradient(135deg, rgba(255, 71, 87, 0.1) 0%, rgba(176, 0, 32, 0.1) 100%);
            border: 2px solid var(--warning);
            border-radius: 15px;
            padding: 25px;
            text-align: center;
        }
        
        .insight-box h3 {
            color: var(--warning);
            margin-bottom: 15px;
            font-size: 1.2rem;
            font-weight: 800;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .insight-text {
            color: var(--light);
            font-size: 1.05rem;
            line-height: 1.8;
            font-weight: 500;
        }
        
        /* Reflection Input */
        .reflection-input {
            width: 100%;
            background: var(--card-elevated);
            border: 2px solid var(--border);
            color: var(--light);
            font-size: 1rem;
            padding: 15px;
            border-radius: 12px;
            outline: none;
            font-family: 'Inter', sans-serif;
            resize: vertical;
            min-height: 100px;
            transition: all 0.3s ease;
        }
        
        .reflection-input:focus {
            border-color: var(--primary);
            box-shadow: 0 0 20px var(--primary-glow);
        }
        
        .reflection-input::placeholder {
            color: var(--gray);
            font-style: italic;
        }
        
        .reflection-note {
            margin-top: 10px;
            font-size: 0.85rem;
            color: var(--gray);
            text-align: center;
        }
        
        /* Download Button */
        .download-section {
            text-align: center;
            margin-top: 30px;
            padding-top: 30px;
            border-top: 1px solid var(--border);
        }
        
        .btn-download {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            padding: 14px 28px;
            background: transparent;
            color: var(--primary);
            border: 2px solid var(--primary);
            border-radius: 30px;
            font-size: 0.95rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
        }
        
        .btn-download:hover {
            background: var(--primary);
            color: white;
            transform: translateY(-3px);
            box-shadow: 0 6px 20px var(--primary-glow);
        }
        
        footer {
            text-align: center;
            margin-top: 40px;
            color: var(--gray);
            font-size: 0.9rem;
            padding: 25px 20px;
            border-top: 1px solid var(--border);
            background: rgba(26, 26, 26, 0.5);
            border-radius: 15px;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .container {
                max-width: 100%;
            }
            
            h1 {
                font-size: 1.8rem;
            }
            
            .glance-stats {
                grid-template-columns: 1fr;
            }
            
            .chart-container {
                height: 250px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="index.html" class="back-link">
            <i class="fas fa-arrow-left"></i> Back to FlowFocus
        </a>
        
        <header>
            <h1>Weekly Reflection</h1>
            <p class="week-range" id="weekRange">Week of ...</p>
        </header>
        
        <!-- At a Glance -->
        <div class="card">
            <h2 class="card-title"><i class="fas fa-eye"></i> At a Glance</h2>
            
            <div class="glance-stats">
                <div class="glance-item">
                    <div class="glance-value" id="weekProgress">0h 0m</div>
                    <div class="glance-label">This Week</div>
                    <div class="glance-sublabel" id="weekPercentage">0% of 30h goal</div>
                </div>
                
                <div class="glance-item">
                    <div class="glance-value" id="dailyAvg">0h 0m</div>
                    <div class="glance-label">Daily Average</div>
                </div>
                
                <div class="glance-item">
                    <div class="glance-value" id="bestDay">—</div>
                    <div class="glance-label">Best Day</div>
                    <div class="glance-sublabel" id="bestDayHours">—</div>
                </div>
                
                <div class="glance-item">
                    <div class="glance-value" id="currentStreak">0</div>
                    <div class="glance-label">Current Streak</div>
                    <div class="glance-sublabel">days</div>
                </div>
            </div>
            
            <div class="comparison">
                <p class="comparison-text" id="comparisonText">
                    Start tracking to see your week-to-week comparison
                </p>
            </div>
        </div>
        
        <!-- This Week's Pattern -->
        <div class="card">
            <h2 class="card-title"><i class="fas fa-chart-bar"></i> This Week's Pattern</h2>
            <div class="chart-container">
                <canvas id="weeklyChart"></canvas>
            </div>
        </div>
        
        <!-- One Thing to Know -->
        <div class="card">
            <div class="insight-box">
                <h3><i class="fas fa-lightbulb"></i> One Thing to Know</h3>
                <p class="insight-text" id="insightText">
                    Start tracking your hours to see personalized insights here.
                </p>
            </div>
        </div>
        
        <!-- How This Week Felt -->
        <div class="card">
            <h2 class="card-title"><i class="fas fa-heart"></i> How This Week Felt</h2>
            <textarea 
                class="reflection-input" 
                id="reflectionInput"
                placeholder="Optional: How did this week feel? What worked? What didn't? (This is just for you—not analyzed or shared.)"
            ></textarea>
            <p class="reflection-note">Your reflection is saved locally and never shared</p>
        </div>
        
        <!-- Download Section -->
        <div class="download-section">
            <button class="btn-download" id="downloadBtn">
                <i class="fas fa-download"></i> Download CSV
            </button>
        </div>
        
        <footer>
            <p>Reflection over analysis • Progress over perfection</p>
        </footer>
    </div>

    <script>
        // Load data from localStorage
        let weekData = {};
        let currentStreak = 0;
        let reflections = {};
        
        const weeklyGoalSeconds = 30 * 3600;
        const dailyGoalSeconds = 6 * 3600;
        const daysOfWeek = ['Sat', 'Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri'];
        
        function init() {
            loadData();
            updateWeekRange();
            updateGlanceStats();
            updateComparison();
            createWeeklyChart();
            updateInsight();
            loadReflection();
            
            // Save reflection on change
            document.getElementById('reflectionInput').addEventListener('input', saveReflection);
            document.getElementById('downloadBtn').addEventListener('click', downloadCSV);
        }
        
        function loadData() {
            const savedWeekData = localStorage.getItem('flowFocusWeekData');
            const savedStreak = localStorage.getItem('flowFocusStreak');
            const savedReflections = localStorage.getItem('flowFocusReflections');
            
            if (savedWeekData) weekData = JSON.parse(savedWeekData);
            if (savedStreak) currentStreak = parseInt(savedStreak);
            if (savedReflections) reflections = JSON.parse(savedReflections);
        }
        
        function getWeekDates() {
            const dates = [];
            const today = new Date();
            const dayOfWeek = today.getDay();
            const daysToSaturday = (dayOfWeek + 1) % 7;
            const startOfWeek = new Date(today);
            startOfWeek.setDate(today.getDate() - daysToSaturday);
            
            for (let i = 0; i < 7; i++) {
                const date = new Date(startOfWeek);
                date.setDate(startOfWeek.getDate() + i);
                dates.push(date);
            }
            
            return dates;
        }
        
        function updateWeekRange() {
            const dates = getWeekDates();
            const start = dates[0];
            const end = dates[6];
            
            const options = { month: 'short', day: 'numeric' };
            const startStr = start.toLocaleDateString('en-US', options);
            const endStr = end.toLocaleDateString('en-US', options);
            const year = end.getFullYear();
            
            document.getElementById('weekRange').textContent = `Week of ${startStr} - ${endStr}, ${year}`;
        }
        
        function getWeekTotal() {
            let total = 0;
            getWeekDates().forEach(date => {
                const key = date.toISOString().split('T')[0];
                if (weekData[key]) total += weekData[key];
            });
            return total;
        }
        
        function getPreviousWeekTotal() {
            let total = 0;
            const today = new Date();
            const dayOfWeek = today.getDay();
            const daysToSaturday = (dayOfWeek + 1) % 7;
            const startOfLastWeek = new Date(today);
            startOfLastWeek.setDate(today.getDate() - daysToSaturday - 7);
            
            for (let i = 0; i < 7; i++) {
                const date = new Date(startOfLastWeek);
                date.setDate(startOfLastWeek.getDate() + i);
                const key = date.toISOString().split('T')[0];
                if (weekData[key]) total += weekData[key];
            }
            
            return total;
        }
        
        function updateGlanceStats() {
            const weekTotal = getWeekTotal();
            const dates = getWeekDates();
            
            // This Week
            const weekHours = Math.floor(weekTotal / 3600);
            const weekMinutes = Math.floor((weekTotal % 3600) / 60);
            document.getElementById('weekProgress').textContent = `${weekHours}h ${weekMinutes}m`;
            
            const percentage = Math.round((weekTotal / weeklyGoalSeconds) * 100);
            document.getElementById('weekPercentage').textContent = `${percentage}% of 30h goal`;
            
            // Daily Average
            const today = new Date();
            const daysIntoWeek = dates.findIndex(d => d.toDateString() === today.toDateString()) + 1;
            const avgSeconds = daysIntoWeek > 0 ? weekTotal / daysIntoWeek : 0;
            const avgHours = Math.floor(avgSeconds / 3600);
            const avgMinutes = Math.floor((avgSeconds % 3600) / 60);
            document.getElementById('dailyAvg').textContent = `${avgHours}h ${avgMinutes}m`;
            
            // Best Day
            let bestDayName = '—';
            let bestDaySeconds = 0;
            dates.forEach((date, index) => {
                const key = date.toISOString().split('T')[0];
                if (weekData[key] && weekData[key] > bestDaySeconds) {
                    bestDaySeconds = weekData[key];
                    bestDayName = daysOfWeek[index];
                }
            });
            
            document.getElementById('bestDay').textContent = bestDayName;
            if (bestDaySeconds > 0) {
                const bestHours = Math.floor(bestDaySeconds / 3600);
                const bestMinutes = Math.floor((bestDaySeconds % 3600) / 60);
                document.getElementById('bestDayHours').textContent = `${bestHours}h ${bestMinutes}m`;
            } else {
                document.getElementById('bestDayHours').textContent = '—';
            }
            
            // Streak
            document.getElementById('currentStreak').textContent = currentStreak;
        }
        
        function updateComparison() {
            const thisWeek = getWeekTotal();
            const lastWeek = getPreviousWeekTotal();
            
            if (lastWeek === 0) {
                document.getElementById('comparisonText').innerHTML = 
                    'Start tracking to see your week-to-week comparison';
                return;
            }
            
            const thisWeekHours = Math.floor(thisWeek / 3600);
            const thisWeekMinutes = Math.floor((thisWeek % 3600) / 60);
            const lastWeekHours = Math.floor(lastWeek / 3600);
            const lastWeekMinutes = Math.floor((lastWeek % 3600) / 60);
            
            const diff = thisWeek - lastWeek;
            const diffHours = Math.floor(Math.abs(diff) / 3600);
            const diffMinutes = Math.floor((Math.abs(diff) % 3600) / 60);
            
            let comparisonHTML = `Last Week: <strong>${lastWeekHours}h ${lastWeekMinutes}m</strong><br>`;
            comparisonHTML += `This Week: <strong>${thisWeekHours}h ${thisWeekMinutes}m</strong><br>`;
            
            if (diff > 0) {
                comparisonHTML += `<span class="comparison-arrow">→ ${diffHours}h ${diffMinutes}m more (nice!)</span>`;
            } else if (diff < 0) {
                comparisonHTML += `<span class="comparison-arrow">→ ${diffHours}h ${diffMinutes}m less (that's okay)</span>`;
            } else {
                comparisonHTML += `<span class="comparison-arrow">→ Same as last week</span>`;
            }
            
            document.getElementById('comparisonText').innerHTML = comparisonHTML;
        }
        
        function createWeeklyChart() {
            const dates = getWeekDates();
            const labels = dates.map((d, i) => daysOfWeek[i]);
            const data = dates.map(date => {
                const key = date.toISOString().split('T')[0];
                return weekData[key] ? weekData[key] / 3600 : 0;
            });
            
            const ctx = document.getElementById('weeklyChart').getContext('2d');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Hours Worked',
                        data: data,
                        backgroundColor: data.map(hours => {
                            const gradient = ctx.createLinearGradient(0, 0, 0, 300);
                            gradient.addColorStop(0, '#dc143c');
                            gradient.addColorStop(0.5, '#ff2e4d');
                            gradient.addColorStop(1, '#ff6b9d');
                            return gradient;
                        }),
                        borderColor: '#1a1a1a',
                        borderWidth: 2,
                        borderRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const hours = Math.floor(context.parsed.y);
                                    const minutes = Math.round((context.parsed.y % 1) * 60);
                                    return `${hours}h ${minutes}m`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 10,
                            grid: {
                                color: '#333',
                                drawBorder: false
                            },
                            ticks: {
                                color: '#a0a0a0',
                                font: {
                                    weight: 600
                                },
                                callback: function(value) {
                                    return value + 'h';
                                }
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            },
                            ticks: {
                                color: '#a0a0a0',
                                font: {
                                    weight: 700,
                                    size: 12
                                }
                            }
                        }
                    }
                }
            });
        }
        
        function updateInsight() {
            const weekTotal = getWeekTotal();
            const dates = getWeekDates();
            const today = new Date();
            const daysIntoWeek = dates.findIndex(d => d.toDateString() === today.toDateString()) + 1;
            
            if (weekTotal === 0) {
                document.getElementById('insightText').textContent = 
                    "Start tracking your hours to see personalized insights here.";
                return;
            }
            
            const avgSeconds = daysIntoWeek > 0 ? weekTotal / daysIntoWeek : 0;
            const avgHours = avgSeconds / 3600;
            const remaining = weeklyGoalSeconds - weekTotal;
            const daysLeft = 7 - daysIntoWeek;
            
            let insight = '';
            
            if (weekTotal >= weeklyGoalSeconds) {
                const extraHours = Math.floor((weekTotal - weeklyGoalSeconds) / 3600);
                insight = `You hit 30 hours! You're ${extraHours}h over your goal. Take it easy or bank these hours mentally for a lighter week ahead.`;
            } else if (avgHours >= 6) {
                const projectedTotal = Math.floor(avgHours * 7);
                insight = `You're averaging ${avgHours.toFixed(1)}h/day. At this pace, you'll finish the week with around ${projectedTotal}h. You're on track!`;
            } else if (daysLeft > 0) {
                const hoursPerDay = Math.ceil(remaining / 3600 / daysLeft);
                insight = `You're averaging ${avgHours.toFixed(1)}h/day. To hit 30h, work around ${hoursPerDay}h on each of the remaining ${daysLeft} days.`;
            } else if (weekTotal >= weeklyGoalSeconds * 0.7) {
                insight = "You're over 70% to your goal! Even if you don't hit 30h exactly, you put in solid work this week.";
            } else {
                insight = "Consistency beats intensity. Focus on showing up tomorrow, even if it's just for an hour.";
            }
            
            document.getElementById('insightText').textContent = insight;
        }
        
        function loadReflection() {
            const weekKey = getWeekKey();
            if (reflections[weekKey]) {
                document.getElementById('reflectionInput').value = reflections[weekKey];
            }
        }
        
        function saveReflection() {
            const weekKey = getWeekKey();
            const reflection = document.getElementById('reflectionInput').value;
            
            reflections[weekKey] = reflection;
            localStorage.setItem('flowFocusReflections', JSON.stringify(reflections));
        }
        
        function getWeekKey() {
            const dates = getWeekDates();
            return dates[0].toISOString().split('T')[0]; // Saturday as week identifier
        }
        
        function downloadCSV() {
            const dates = getWeekDates();
            let csv = 'Date,Day,Hours\n';
            
            dates.forEach((date, index) => {
                const key = date.toISOString().split('T')[0];
                const seconds = weekData[key] || 0;
                const hours = (seconds / 3600).toFixed(2);
                const dateStr = date.toLocaleDateString('en-US');
                const dayStr = daysOfWeek[index];
                
                csv += `${dateStr},${dayStr},${hours}\n`;
            });
            
            // Create download
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `flowfocus-week-${getWeekKey()}.csv`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
        }
        
        // Initialize
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
